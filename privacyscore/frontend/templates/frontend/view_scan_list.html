{% extends 'frontend/base.html' %}
{% load static %}
{% load i18n %}

{% block title %}Results for {{ scan_list.name }}{% endblock title %}

{% block additional_css %}
<style type="text/css">
.align-center {
  text-align: center;
}

.align-right {
  text-align: right;
}

.unreachable {
  opacity: 0.6;
}

.rating-doubleplusgood, .rating-good {
  background: #27FB6B;
}

.rating-warning {
  background: #FCAB10;
}

.rating-bad {
  background: #E02C2C;
}
</style>
{% endblock additional_css %}

{% block content %}
    <h1>
      {{ scan_list.name }}
    </h1>


    <div class="row">
      <div class="col-md-9">
        <div class="box">
          <span class="glyphicon glyphicon-info-sign" data-toggle="tooltip" title="{% trans 'Description' %}" id="tooltipDescription"></span>
          <span id="description">{{ scan_list.description }}</span>
        </div>
        <div class="box">
          <span class="glyphicon glyphicon-tags" data-toggle="tooltip" title="{% trans 'Tags' %}" id="tooltipTags"></span>
          <span id="tags">{{ scan_list.tags_as_str }}</span>
        </div>
        <div class="box">
          <span class="glyphicon glyphicon-time" data-toggle="tooltip" title="Zeit" id="tooltipTime">{{ scan_list.last_scan_datetime|date:"j.n.Y H:i" }}</span>
          <span id="startdate"></span> <i class="fa fa-long-arrow-right"></i>
        </div>
        <div class="box">
          <i class="fa fa-hand-o-right" data-toggle="tooltip" id="popularThirdParties"></i>
          <a id="popularThirdPartiesButton" href="TODO" style="color:black;">

            <span id="popularThirdPartiesDiv">Häufige Third Parties</span>
          </a>
        </div>
        <div class="well-sm result">
           <div class="row result-body" id="dashboard" style="display:none; padding-top:15px;">
            <div class="col-md-3">
              <div class="result-value"></div>
              <div id="dashboardScore">Durchschnittliche Bewertung</div>
              </div>
              <div class="col-md-3">
              <div class="result-value"></div>
              <div id="dashboardHTTPS">der Seiten bieten HTTPS als Standard an</div>
              </div>
              <div class="col-md-3">
              <div class="result-value"></div>
              <div id="dashboardCookies">Durchschnittliche Anzahl an Cookies</div>
              </div>
              <div class="col-md-3">
              <div class="result-value"></div>
              <div id="dashboardThirdParties">Durchschnittliche Anzahl an Third Parties</div>

              </div>
          </div>
        </div>
      </div>

      <div class="col-md-3">


        <a class="btn btn-default" onclick="deleteList()" role="button" id="delete_list" style="width:100%; display:none;">Liste löschen</a>
        <form method="POST" action="{% url 'frontend:scan_scan_list' scan_list.pk %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-default" role="button" id="scan_again" style="width:100%;">
            {% trans 'Rescan' %}
          </button>
        </form>
        <a href="{% url 'frontend:scan_list' %}" class="btn btn-default" role="button" id="new_list" style="width:100%;">Neue Liste aus dieser erstellen</a>

         <div class="form-group">
          <label id="labelShowScan">Scan anzeigen</label>
          <select onchange="location = this.options[this.selectedIndex].value;" class="form-control" id="oldNewScans">
          </select>

        <div id="compareDiv">
        <input type="checkbox" id="compareCheckbox" value="" onclick="toggleCompare();">
          <label id="labelCompareScan">Vergleichs-Scan</label>
          <select onchange="dropdownAction()" class="form-control" id="compareScans">
          </select>
        </div>
        </div>
      </div>
    </div>

  <table class="table table-striped table-bordered table-hover">
    <tr>
      <th>#</th>
      <th>{% trans 'URL' %}</th>
      {% for column in scan_list.ordered_columns %}
        <th>{{ column.name }}</th>
      {% endfor %}
      <th>{% trans 'Result' %}</th>
      {% for group in result_groups %}
        <th>{{ group }}</th>
      {% endfor %}
      <th class="align-right">{% trans 'Scan time' %}</th>
      <th class="align-right">{% trans 'Failures' %}</th>
    </tr>

    {% for num, site in sites %}
      <tr{% if site.result.result.reachable is False %} class="unreachable"{% endif %}>
        <td>
          {{ num }}
        </td>
        <td>
          <a href="{% url 'frontend:view_site' site.pk %}">
            {{ site.url }}
          </a>
        </td>
        {% for column_value in site.ordered_column_values %}
          <th>{{ column_value.value }}</th>
        {% endfor %}
        <td class="rating-{{ site.evaluated.rating }}"></td>
        {% for group, rating in site.evaluated %}
          {% if rating %}
            <td class="rating-{{ rating.group_rating }}">
              {{ rating.group_rating }}
              {%  blocktrans with overall_good=rating.overall_good good=rating.good overall_total=rating.overall_total total=rating.total %}
                ({{ good }}/{{ total }} [{{ overall_good }}/{{ overall_total }}] good)
              {% endblocktrans %}
              {% if rating.group_rating.rating == 'doubleplusgood' %}
                <i class="fa fa-star-o" aria-hidden="true"></i>
              {% endif %}
            </td>
          {% else %}
            <td>
              {% trans 'n/a' %}
            </td>
          {% endif %}
        {% empty %}
          <td class="align-center" colspan="{{ result_groups|length }}">{% trans 'n/a' %}</td>
        {% endfor %}
        <td class="align-right">{% if site.last_scan_datetime is not None %}{{ site.last_scan_datetime }}{% else %}--{% endif %}</td>
        <td class="align-right">{{ site.last_scan__error_count }}</td>
      </tr>
    {% endfor %}
  </table>

{% endblock content %}
